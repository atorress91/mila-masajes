---
import Layout from '../../../layouts/Layout.astro';
import Header from '../../../components/Header.astro';
import Footer from '../../../components/Footer.astro';
import { getLocations, urlFor } from '../../../lib/sanity';
import { SUPPORTED_LANGS, getLangFromAstro, withLangParam } from '../../../lib/i18n';
import { getTranslations } from '../../../lib/translations';

export function getStaticPaths() {
  return SUPPORTED_LANGS.map(lang => ({ params: { lang } }));
}

const lang = getLangFromAstro(Astro);
const copy = getTranslations(lang);
const localizedHref = (path: string) => withLangParam(path, lang);
const currentPath = `${Astro.url.pathname}${Astro.url.search}`;

const locations = await getLocations(lang);
const baseDescription = copy.locations.overview.metaDescription;
---

<Layout title={copy.locations.overview.pageTitle} description={baseDescription} lang={lang}>
  <Header lang={lang} copy={copy} currentPath={currentPath} />

  <main class="location-page locations-overview">
    <section class="location-hero small">
      <div class="overlay"></div>
      <div class="container hero-content">
        <p class="eyebrow">{copy.locations.overview.heroEyebrow}</p>
        <h1>{copy.locations.overview.heroTitle}</h1>
        <p class="lead">{copy.locations.overview.heroSubtitle}</p>
      </div>
    </section>

    <section class="location-services">
      <div class="container">
        <div class="section-heading">
          <span>{copy.locations.overview.sectionEyebrow}</span>
          <h2>{copy.locations.overview.sectionTitle}</h2>
          <p>{copy.locations.overview.sectionSubtitle}</p>
        </div>

        {
          locations.length > 0 ? (
            <div class="service-card-grid">
              {locations.map(location => {
                const locationImageAlt = location.heroImage?.alt || `${location.name} - Massage services`;
                return (
                  <article class="service-card location-card">
                    <div class="service-card-image">
                      <img
                        src={
                          location.heroImage
                            ? urlFor(location.heroImage).width(600).height(400).url()
                            : '/assets/service-2.jpg'
                        }
                        alt={locationImageAlt}
                        loading="lazy"
                      />
                    </div>
                    <div class="service-card-body">
                      <div class="service-meta">
                        <span>{location.serviceAreas?.length || 1} zonas</span>
                        <span>#{(location.order ?? 0) + 1}</span>
                      </div>
                      <h3>{location.name}</h3>
                      <p>
                        {location.description || location.seoDescription || copy.locations.overview.descriptionFallback}
                      </p>
                      <div class="service-actions">
                        <a href={localizedHref(`/ubicaciones/${location.slug.current}`)} class="btn-primary">
                          {copy.locations.overview.detailsButton}
                        </a>
                      </div>
                    </div>
                  </article>
                );
              })}
            </div>
          ) : (
            <p class="empty-state">{copy.locations.overview.emptyState}</p>
          )
        }
      </div>
    </section>
  </main>

  <Footer lang={lang} copy={copy} />
</Layout>

<style>
  @import '../../../styles/locations.css';

  .location-card .service-meta span:last-child {
    font-size: 0.85rem;
    color: var(--text-secondary);
  }
</style>
