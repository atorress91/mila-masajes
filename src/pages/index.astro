---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import {
  getPageContent,
  getFeaturedServices,
  getBenefits,
  urlFor
} from '../lib/sanity';

// Obtener datos de Sanity
let pageData: any = null;
let featuredServices: any[] = [];
let benefits: any[] = [];

try {
  pageData = await getPageContent('homepage');
  featuredServices = await getFeaturedServices();
  benefits = await getBenefits();
} catch (error) {
  console.error('Error fetching from Sanity:', error);
  // Usar valores por defecto si Sanity falla
}
---

<Layout
  title={pageData?.title || 'MLA Massage & Wellness'}
  description={pageData?.description || 'Experience ultimate relaxation with our professional massage therapy services'}
>
  <Header />

  <main>
    <!-- Hero Section -->
    <section class="hero">
      <div class="container">
        <div class="hero-content">
          {/* Background image */}
          <div class="hero-background">
            {pageData?.heroImage ? (
              <img
                src={urlFor(pageData.heroImage).width(1400).height(900).format('webp').url()}
                alt={pageData.heroImage.alt || 'Relaxing spa atmosphere'}
              />
            ) : (
              <img src="/assets/hero-massage.jpg" alt="Relaxing massage therapy" />
            )}
          </div>

          {/* Text overlay */}
          <div class="hero-text">
            <h1 class="hero-title">{pageData?.heroTitle || 'Relax and Unwind!'}</h1>
            <p class="hero-subtitle">{pageData?.heroSubtitle || 'Explore our range of soothing services. Experience tranquility and rejuvenation.'}</p>
            <div class="hero-buttons">
              <a href="/discover" class="btn-primary">Discover</a>
            </div>
          </div>
        </div>

        <!-- Right side images -->
        <div class="hero-images-side">
          {pageData?.heroImageTopRight ? (
            <div class="hero-image-small">
              <img
                src={urlFor(pageData.heroImageTopRight).width(800).height(800).format('webp').url()}
                alt={pageData.heroImageTopRight.alt || 'Essential oils and aromatherapy'}
              />
            </div>
          ) : (
            <div class="hero-image-small">
              <img src="/assets/service-1.jpg" alt="Essential oils" />
            </div>
          )}

          {pageData?.heroImageBottomRight ? (
            <div class="hero-image-small">
              <img
                src={urlFor(pageData.heroImageBottomRight).width(800).height(800).format('webp').url()}
                alt={pageData.heroImageBottomRight.alt || 'Spa products and ambiance'}
              />
            </div>
          ) : (
            <div class="hero-image-small">
              <img src="/assets/service-2.jpg" alt="Spa products" />
            </div>
          )}
        </div>
      </div>
    </section>

    <!-- Benefits Section -->
    <section class="benefits-section">
      <div class="container">
        <h2 class="section-title">Benefits of Our Massage Therapies</h2>
        <p class="section-subtitle">Discover how our professional treatments can transform your well-being</p>

        <div class="benefits-grid">
          {benefits && benefits.length > 0 ? (
            benefits.map((benefit) => (
              <div class="benefit-card stagger-item">
                <div class="benefit-icon" set:html={benefit.icon} />
                <h3>{benefit.title}</h3>
                <p>{benefit.description}</p>
                <ul class="benefit-list">
                  {benefit.items?.map((item: string) => (
                    <li>{item}</li>
                  ))}
                </ul>
              </div>
            ))
          ) : (
            <!-- Fallback si no hay datos en Sanity -->
            <div class="benefit-card stagger-item">
              <div class="benefit-icon">
                <svg width="60" height="60" viewBox="0 0 60 60" fill="none">
                  <circle cx="30" cy="30" r="28" fill="var(--primary-color)" />
                  <path d="M30 15C21.716 15 15 21.716 15 30C15 38.284 21.716 45 30 45C38.284 45 45 38.284 45 30C45 21.716 38.284 15 30 15ZM30 40C24.477 40 20 35.523 20 30C20 24.477 24.477 20 30 20C35.523 20 40 24.477 40 30C40 35.523 35.523 40 30 40Z" fill="var(--accent-color)" />
                  <circle cx="30" cy="30" r="4" fill="var(--accent-color)" />
                </svg>
              </div>
              <h3>No benefits loaded</h3>
              <p>Add benefits in Sanity Studio at http://localhost:3333</p>
            </div>
          )}
        </div>

        <!-- CTA Banner -->
        <div class="benefits-cta">
          <div class="cta-content">
            <h3>Ready to Experience These Benefits?</h3>
            <p>Book your personalized massage therapy session today and start your journey to wellness</p>
            <a href="/discover" class="btn-primary">Explore Our Services</a>
          </div>
        </div>
      </div>
    </section>

    <!-- Services Preview -->
    <section class="quick-services-preview">
      <div class="container">
        <div class="quick-services-header">
          <span class="quick-eyebrow">Our Expertise</span>
          <h2 class="quick-services-title">Featured Services</h2>
          <p class="quick-services-tagline">Professional massage therapies tailored to your needs</p>
        </div>

        <div class="quick-services-grid">
          {featuredServices && featuredServices.length > 0 ? (
            featuredServices.slice(0, 4).map((service: any) => (
              <a href="/discover" class="quick-service-card">
                <div class="quick-service-image">
                  {service.image ? (
                    <img
                      src={urlFor(service.image).width(500).height(600).format('webp').url()}
                      alt={service.image.alt || service.title}
                    />
                  ) : (
                    <img src="/assets/service-1.jpg" alt={service.title} />
                  )}
                  <div class="quick-service-overlay">
                    <span class="quick-service-cta">Explore</span>
                  </div>
                </div>
                <div class="quick-service-content">
                  <h3 class="quick-service-title">{service.title}</h3>
                  <p class="quick-service-snippet">
                    {service.description?.substring(0, 85)}...
                  </p>
                  <div class="quick-service-footer">
                    <span class="quick-service-price">${service.price}</span>
                    <span class="quick-service-duration">{service.duration} min</span>
                  </div>
                </div>
              </a>
            ))
          ) : null}
        </div>
      </div>
    </section>
  </main>

  <Footer />
</Layout>

<style>
  @import '../styles/index.css';
</style>
