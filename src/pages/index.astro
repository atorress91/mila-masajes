---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { 
  getPageContent, 
  getFeaturedServices, 
  getBenefits,
  urlFor 
} from '../lib/sanity';

// Obtener datos de Sanity
let pageData: any = null;
let featuredServices: any[] = [];
let benefits: any[] = [];

try {
  pageData = await getPageContent('homepage');
  featuredServices = await getFeaturedServices();
  benefits = await getBenefits();
} catch (error) {
  console.error('Error fetching from Sanity:', error);
  // Usar valores por defecto si Sanity falla
}
---

<Layout 
  title={pageData?.title || 'Massage Bliss - Professional Spa & Massage Therapy'}
  description={pageData?.description || 'Experience ultimate relaxation with our professional massage therapy services'}
>
  <Header />
  
  <main>
    <!-- Hero Section -->
    <section class="hero">
      <div class="container">
        <div class="hero-content">
          <h1 class="hero-title">{pageData?.heroTitle || 'Relax & Rejuvenate'}</h1>
          <p class="hero-subtitle">{pageData?.heroSubtitle || 'Experience the ultimate in relaxation with our professional massage therapies'}</p>
          <div class="hero-buttons">
            <a href="/discover" class="btn-primary">Browse Services</a>
            <a href="/contact" class="btn-secondary">Contact Us</a>
          </div>
        </div>
        <div class="hero-image">
          {pageData?.heroImage ? (
            <img 
              src={urlFor(pageData.heroImage).width(800).height(600).format('webp').url()} 
              alt={pageData.heroImage.alt || 'Relaxing massage therapy'} 
            />
          ) : (
            <img src="/assets/hero-massage.jpg" alt="Relaxing massage therapy" />
          )}
        </div>
      </div>
      
      <!-- Hero Decorative SVG -->
      <div class="hero-svg-decoration">
        <img src="/hero.svg" alt="Decorative element" class="hero-svg" />
      </div>
    </section>

    <!-- Benefits Section -->
    <section class="benefits-section">
      <div class="container">
        <h2 class="section-title">Benefits of Our Massage Therapies</h2>
        <p class="section-subtitle">Discover how our professional treatments can transform your well-being</p>
        
        <div class="benefits-grid">
          {benefits && benefits.length > 0 ? (
            benefits.map((benefit) => (
              <div class="benefit-card stagger-item">
                <div class="benefit-icon" set:html={benefit.icon} />
                <h3>{benefit.title}</h3>
                <p>{benefit.description}</p>
                <ul class="benefit-list">
                  {benefit.items?.map((item: string) => (
                    <li>{item}</li>
                  ))}
                </ul>
              </div>
            ))
          ) : (
            <!-- Fallback si no hay datos en Sanity -->
            <div class="benefit-card stagger-item">
              <div class="benefit-icon">
                <svg width="60" height="60" viewBox="0 0 60 60" fill="none">
                  <circle cx="30" cy="30" r="28" fill="var(--primary-color)" />
                  <path d="M30 15C21.716 15 15 21.716 15 30C15 38.284 21.716 45 30 45C38.284 45 45 38.284 45 30C45 21.716 38.284 15 30 15ZM30 40C24.477 40 20 35.523 20 30C20 24.477 24.477 20 30 20C35.523 20 40 24.477 40 30C40 35.523 35.523 40 30 40Z" fill="var(--accent-color)" />
                  <circle cx="30" cy="30" r="4" fill="var(--accent-color)" />
                </svg>
              </div>
              <h3>No benefits loaded</h3>
              <p>Add benefits in Sanity Studio at http://localhost:3333</p>
            </div>
          )}
        </div>

        <!-- CTA Banner -->
        <div class="benefits-cta">
          <div class="cta-content">
            <h3>Ready to Experience These Benefits?</h3>
            <p>Book your personalized massage therapy session today and start your journey to wellness</p>
            <a href="/discover" class="btn-primary">Explore Our Services</a>
          </div>
        </div>
      </div>
    </section>

    <!-- Services Preview -->
    <section class="services-preview">
      <div class="container">
        <h2 class="section-title">Featured Services</h2>
        <p class="section-subtitle">Discover our most popular massage therapies</p>
        
        <div class="services-grid">
          {featuredServices && featuredServices.length > 0 ? (
            featuredServices.map((service: any) => (
              <div class="service-card">
                <div class="service-image">
                  {service.image ? (
                    <img 
                      src={urlFor(service.image).width(500).height(350).format('webp').url()} 
                      alt={service.image.alt || service.title} 
                    />
                  ) : (
                    <img src="/assets/service-placeholder.jpg" alt={service.title} />
                  )}
                </div>
                <h3>{service.title}</h3>
                <p>{service.description}</p>
                <div class="service-details">
                  <span class="price">${service.price}</span>
                  <span class="duration">{service.duration} min</span>
                </div>
              </div>
            ))
          ) : (
            <!-- Fallback si no hay servicios en Sanity -->
            <div class="service-card">
              <div class="service-image">
                <img src="/assets/service-1.jpg" alt="Service" />
              </div>
              <h3>No services loaded</h3>
              <p>Add services in Sanity Studio at http://localhost:3333</p>
              <span class="price">$0</span>
            </div>
          )}
        </div>

        <div class="cta-center">
          <a href="/discover" class="btn-primary">View All Services</a>
        </div>
      </div>
    </section>
  </main>

  <Footer />
</Layout>

<style>
  .hero {
    padding: 80px 0;
    background: var(--white);
  }

  .hero .container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 60px;
    align-items: center;
  }

  .hero-title {
    font-size: 64px;
    font-weight: 700;
    margin-bottom: 20px;
    color: var(--text-primary);
  }

  .hero-subtitle {
    font-size: 20px;
    color: var(--text-secondary);
    margin-bottom: 40px;
    line-height: 1.8;
  }

  .hero-buttons {
    display: flex;
    gap: 20px;
  }

  .hero-image {
    width: 100%;
    height: 500px;
    border-radius: 20px;
    overflow: hidden;
  }

  .hero-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Hero SVG Decoration */
  .hero-svg-decoration {
    width: 100%;
    margin-top: 60px;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .hero-svg {
    width: 100%;
    max-width: 100%;
    height: auto;
    display: block;
  }

  /* Benefits Section */
  .benefits-section {
    padding: 100px 0;
    background: linear-gradient(135deg, var(--white) 0%, var(--primary-color) 100%);
    position: relative;
    overflow: hidden;
  }

  .benefits-section::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -20%;
    width: 600px;
    height: 600px;
    background: radial-gradient(circle, rgba(123, 168, 154, 0.1) 0%, transparent 70%);
    border-radius: 50%;
  }

  .benefits-section::after {
    content: '';
    position: absolute;
    bottom: -30%;
    left: -10%;
    width: 400px;
    height: 400px;
    background: radial-gradient(circle, rgba(201, 184, 168, 0.1) 0%, transparent 70%);
    border-radius: 50%;
  }

  .benefits-section .container {
    position: relative;
    z-index: 1;
  }

  .benefits-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 40px;
    margin-bottom: 60px;
  }

  .benefit-card {
    background: white;
    padding: 40px 30px;
    border-radius: 20px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }

  .benefit-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, var(--accent-color), var(--accent-secondary));
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.4s ease;
  }

  .benefit-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 12px 40px rgba(123, 168, 154, 0.15);
  }

  .benefit-card:hover::before {
    transform: scaleX(1);
  }

  .benefit-icon {
    margin-bottom: 25px;
    animation: float 3s ease-in-out infinite;
  }

  .benefit-card:nth-child(2) .benefit-icon {
    animation-delay: 0.5s;
  }

  .benefit-card:nth-child(3) .benefit-icon {
    animation-delay: 1s;
  }

  .benefit-card:nth-child(4) .benefit-icon {
    animation-delay: 1.5s;
  }

  .benefit-card:nth-child(5) .benefit-icon {
    animation-delay: 2s;
  }

  .benefit-card:nth-child(6) .benefit-icon {
    animation-delay: 2.5s;
  }

  .benefit-card h3 {
    font-size: 24px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 15px;
  }

  .benefit-card > p {
    font-size: 16px;
    color: var(--text-secondary);
    line-height: 1.6;
    margin-bottom: 20px;
  }

  .benefit-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .benefit-list li {
    font-size: 14px;
    color: var(--text-secondary);
    padding: 8px 0;
    padding-left: 25px;
    position: relative;
  }

  .benefit-list li::before {
    content: 'âœ“';
    position: absolute;
    left: 0;
    color: var(--accent-color);
    font-weight: bold;
    font-size: 16px;
  }

  /* Benefits CTA */
  .benefits-cta {
    background: linear-gradient(135deg, var(--accent-color) 0%, var(--accent-secondary) 100%);
    border-radius: 24px;
    padding: 60px 40px;
    text-align: center;
    box-shadow: 0 10px 40px rgba(123, 168, 154, 0.2);
    position: relative;
    overflow: hidden;
  }

  .benefits-cta::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -20%;
    width: 300px;
    height: 300px;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
    border-radius: 50%;
  }

  .cta-content {
    position: relative;
    z-index: 1;
  }

  .benefits-cta h3 {
    font-size: 36px;
    font-weight: 700;
    color: white;
    margin-bottom: 15px;
  }

  .benefits-cta p {
    font-size: 18px;
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 30px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }

  .benefits-cta .btn-primary {
    background: white;
    color: var(--accent-color);
    font-size: 18px;
    padding: 18px 45px;
    display: inline-block;
    text-decoration: none;
  }

  .benefits-cta .btn-primary:hover {
    background: var(--background-light);
    transform: translateY(-3px);
  }

  .services-preview {
    padding: 80px 0;
    background: var(--background-light);
  }

  .section-title {
    font-size: 48px;
    font-weight: 700;
    text-align: center;
    margin-bottom: 16px;
    color: var(--text-primary);
  }

  .section-subtitle {
    font-size: 18px;
    color: var(--text-secondary);
    text-align: center;
    margin-bottom: 60px;
  }

  .services-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 40px;
    margin-bottom: 60px;
  }

  .service-card {
    background: white;
    border-radius: 20px;
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
  }

  .service-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
  }

  .service-image {
    width: 100%;
    height: 250px;
    overflow: hidden;
  }

  .service-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .service-card:hover .service-image img {
    transform: scale(1.1);
  }

  .service-card h3 {
    font-size: 24px;
    font-weight: 600;
    padding: 20px 20px 10px;
    color: var(--text-primary);
  }

  .service-card p {
    font-size: 16px;
    color: var(--text-secondary);
    padding: 0 20px 15px;
  }

  .service-details {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 20px 30px;
  }

  .service-card .price {
    font-size: 28px;
    font-weight: 700;
    color: var(--accent-color);
  }

  .service-card .duration {
    font-size: 14px;
    color: var(--text-secondary);
    font-weight: 500;
  }

  .cta-center {
    display: flex;
    justify-content: center;
  }

  @media (max-width: 968px) {
    .hero .container {
      grid-template-columns: 1fr;
      gap: 40px;
    }

    .hero-title {
      font-size: 48px;
    }

    .benefits-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 30px;
    }

    .services-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 30px;
    }

    .benefits-cta h3 {
      font-size: 28px;
    }

    .benefits-cta p {
      font-size: 16px;
    }
  }

  @media (max-width: 768px) {
    .hero-title {
      font-size: 36px;
    }

    .hero-buttons {
      flex-direction: column;
    }

    .benefits-section {
      padding: 60px 0;
    }

    .benefits-grid {
      grid-template-columns: 1fr;
      gap: 25px;
      margin-bottom: 40px;
    }

    .benefit-card {
      padding: 30px 25px;
    }

    .benefit-card h3 {
      font-size: 20px;
    }

    .benefits-cta {
      padding: 40px 30px;
    }

    .benefits-cta h3 {
      font-size: 24px;
    }

    .benefits-cta p {
      font-size: 15px;
    }

    .services-grid {
      grid-template-columns: 1fr;
    }

    .section-title {
      font-size: 36px;
    }
  }
</style>
